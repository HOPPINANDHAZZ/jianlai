<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<h1>超级管理员</h1>
<button id="btn2">点我登录</button>
<button id="btn3">点我登出</button>
<input id="ip" type="text" value="http://127.0.0.1:8809">
</body>
<script src="../static/js/jquery-3.5.1.min.js"></script>
<script src="../static/js/zjax.js"></script>

<script>
    $(function () {
        let ip="http://1.15.232.156:8809";
        $("#btn2").click(function (){
            ip=$("#ip").val();
            $.ajax({
                url:"/hoppinzq?method=login",
                data:JSON.stringify({
                    "user":{
                        "username":"zhangqi1",
                        "password":"19zhangqi"
                    }
                }),
                dataType:"json",
                type:"post",
                success:function (data) {
                    if(data.code==200){
                        let zq_token=getCookie("ZQ_TOKEN");
                        alert("登陆成功，有效时长10min");
                        let query = window.location.search.substring(1);
                        let reUrl=query.split("redirect=")[1];
                        // if(reUrl.indexOf(window.location.host)==-1){
                        //     $("body").append($("<iframe style='display: none' src='"+ip+"/cookie.html?cookie='"+zq_token+"&redirect="+reUrl+"></iframe>"));
                        // }else{
                        //     window.location.href=reUrl;
                        // }
                        window.location.href=reUrl;
                    }else{
                        alert("登陆失败:"+JSON.stringify(data));
                    }
                }
            })
        })

        $("#btn3").click(function (){
            $.ajax({
                url:"/hoppinzq?method=logout&params=",
                success:function (data) {
                    alert("登出成功")
                }
            })
        })
    })

    function removePort(url){
        return url.substring(0,url.lastIndexOf(":"));
    }

    function getCookie(cname){
        let name = cname + "=";
        let ca = document.cookie.split(';');
        for(let i=0; i<ca.length; i++)
        {
            let c = ca[i].trim();
            if (c.indexOf(name)==0) return c.substring(name.length,c.length);
        }
        return "";
    }
</script>
</html>